> Read [original](https://tools.ietf.org/html/draft-vvv-webtransport-overview-01) / [markdown](../markdown/draft-vvv-webtransport-overview-01.md)

---

# The WebTransport Protocol Framework

## Abstract

- WebTransportというプロトコルについて

## 1. Introduction

- WebTransportというプロトコル
- クライアントとサーバー間のセキュアに多重化されたトランスポート
- 安全なプロトコルの組み合わせによって成立している
- この仕様では、必須要件だけでなく、オプショナルの要件についても解説

### 1.1. Background

- クライアント・サーバー間での双方向のデータのやりとりはWebSocketが主流だった
- しかしHOLBの問題があって、低遅延のやり取りには不向き
- その代替としては、WebRTCのDataChannelがある
  - DTLS/SCTPが使われている
  - 本質的には、この仕様で提案したいことが既にできている
- ただし、ICEはWebの特性にマッチしないし、SCTPの実装も数少ない
- HTTP/3でWebSocketをレイヤリングするという手もある
  - HTTP/2でやってるように
  - そうすればHOLBも解消される
- しかしいくつか不適合な点がある
  - ストリームごとに接続に1RTT必要になる
  - クライアントからしか開始できない
- WebTransportでは、これらの問題を解決する
  - 1つのトランスポートオブジェクトで、複数のストリームを単一のコンテキストで処理する
  - UDPのように、unreliableなデータも送信できる

### 1.2. Conventions and Definitions

- 用語の説明

## 2. Common Transport Requirements

- WebTransportとして、下層のプロトコルに対する要求は以下の通り
- TLSかそれに準ずるセキュアなプロトコルを使う
  - DTLSでもよい
  - TLS 1.3以降
- なんらかのキープアライブの仕組みがある
  - ICEのそれのような仕組み
- 輻輳制御のために送信データにレート制限ができる
  - フィードバックベース
  - draft-ietf-quic-recovery
- 同時に複数のセッションを確立できる
- オリジンによってクライアントをフィルタリングできる
- サーバーのエンドポイントはURIを持ち、CSPに対応できる

## 3. Session Establishment

- 基本的に非同期で確立する
- TLSが通ったからといって、確立したとは言わない
- 確立するまで先にデータを送ったりしてはいけない
  - 0-RTTみたいな仕組みだけは別

## 4. Transport Features

- 現時点での機能一覧は以下のとおり
- データグラムの送信、単方向、双方向ストリームを提供する

### 4.1. Datagrams

- PMTUによって制限されるバイト列のこと
- unreliableな用途のはず
- 基本的にはUDPをそのまま使えるようなイメージ
  - 下層のトランスポートが再送をサポートしてても再送しない
  - 流量も気にせず送っちゃう
- 送信可能なサイズは指定できる必要がある
  - PMTUを通して

### 4.2. Streams

- 単方向のバイトストリーム
  - 双方向なストリームは、これを2本使って表現する
- ストリームの挙動は、QUICのストリームとステートマシンに従う
- リセットも可能
  - リセットされたらもう再送したりしない
- トランスポートによって輻輳制御される
  - もしかしたらエンドポイントはストリームの本数を制限するかも
- ストリームは64bitのIDを持つ
  - クライアントとサーバーでこのIDを共有する

### 4.3. Protocol-Specific Features

- 特定のプロトコルを利用している場合のみ使える機能もある
- コネクションをプールしないトランスポートの場合
  - パケロスの数やデータ遅延の回数などがわかる
  - 輻輳に関する情報なども

### 4.4. Bandwidth Prediction

- WebTransportのユースケースとしてはほしい機能のはず
  - たとえばリアルタイムに動画を送る場合など
- なので下層のプロトコルはできればそういう機能があるとよい
  - せめて帯域推定だけでもサポートされているべき

## 5. Buffering and Prioritization

- データグラムは低遅延なユースケースを目的としている
- ペイロードは樹分に小さいはず
- ストリームよりも優先度は高く処理されるべき
- Nagleアルゴリズムなどは適用しない

## 6. Transport Properties

- 基本的な機能に加えて、以下の特性をもつ
- ここで定義するのは以下
  - Stream independence: HOLBが異なるストリーム間で起きない
  - Partial reliability: ストリームがリセットされると再送されない
  - Pooling support: 複数のトランスポートにまたがって輻輳制御する
  - Connection mobility: ネットワークパスが変わっても接続を維持する

## 7. Security Considerations

- ローレベルなネットワークレイヤーにアクセスできるAPIはリスクもある
  - なのでTLSのようなセキュリティ機構を必須にしてる
- たとえ接続が確立できなくても、そのエラー情報にすら多量の情報が含まれる
  - なので信頼できないエンドポイントでは、そのエラー情報すら公開してはならない
  - 接続先サーバーの異常なのか、単にアドレスを間違えてるのかですら教えない
- ブラウザベースの認証機構はサポートしない
  - CookieとかHTTP認証とか

## 8. IANA Considerations

- IANAへの要求はない
